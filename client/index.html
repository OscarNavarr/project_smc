<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Charts CDN -->
    <link rel="stylesheet" href="/static/styles.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

</head>
<body>
    <img src="static/img/charts/test.png" class="w-[100%]" alt="chart">
   <div class="bg_images_special h-[100vh]">
        <div class="flex h-[100vh] bg_degred">
            <div class="w-[calc(100vw-50rem)] h-[100vh]  flex justify-center items-center">
                <div class="">
                    <div class="flex justify-center">
                        <h1 id="h1_temp" class="text-white text-[10rem]">22</h1>
                        <p class="text-white text-[7rem]">°C</p>
                    </div>
                    <div>
                        <h2 class="text-white text-[3.5rem] text-center">Dernière Mesure</h2>
                    </div>
                </div>
            </div>
            
            <div class="w-[100%] glassmorphism_bg rounded-l-[3rem] p-[3rem]">
                <div class="flex flex-col">
                    <div class="overflow-x-auto sm:-mx-6 lg:-mx-8">
                        <div class="inline-block min-w-full py-2 sm:px-6 lg:px-8 ">
                            <div class="overflow-y-scroll max-h-[20rem] flex justify-center rounded-[1rem]">
                                <table class="w-full text-left text-sm font-light text-surface dark:text-white rounded-t-xl ">
                                    <thead class="border-b border-neutral-200 font-medium dark:border-white/10 thead-glass-bg text-white rounded-t-xl">
                                        <tr>
                                            <th scope="col" class="px-6 py-4">#</th>
                                            <th scope="col" class="px-6 py-4">Récolte</th>
                                            <th scope="col" class="px-6 py-4">Nom Station</th>
                                            <th scope="col" class="px-6 py-4">Ville</th>
                                            <th scope="col" class="px-6 py-4">Température</th>
                                            <th scope="col" class="px-6 py-4">Humidité du Sol</th>
                                            <th scope="col" class="px-6 py-4">Humidité de l'air</th>
                                            <th scope="col" class="px-6 py-4">Pluviosité</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div> 
                
                <div class="w-full flex justify-center">
                    <div id="curve_chart" style="width: 100%; height: 500px" ></div>
                </div>
                
               
            </div>
        </div>
   </div>
    
    <script src="/static/js_code.js"></script>
    <script type="text/javascript" async>
        google.charts.load('current');
      
        function drawVisualization(data) {
            var options = {
                title: 'Évolution de la Température',
                curveType: 'function',
                legend: { position: 'bottom'},
                pointSize: 10,
                vAxis: {
                    title: 'Température',
                    textStyle: { color: '#fff' },
                    titleTextStyle: { color: '#fff' },
                    areaOpacity: 0.2,
                    viewWindow: {
                        min: 0,
                    },
                    gridlines: {
                        color: '#fff',
                    },
                },
                hAxis: {
                    title: 'Jours',
                    textStyle: { color: '#fff' },
                    titleTextStyle: { color: '#fff' },
                },
                backgroundColor: 'transparent',
                colors: ['#fff'],
                titleTextStyle: {
                    color: '#fff',
                    fontSize: 20,
                },
                legendTextStyle: {
                    color: '#fff',
                    fontSize: 14,
                },
                animation: {
                    duration: 1000, 
                    easing: 'out',
                    startup: true, 
                    refreshInterval: 1000 
                }
            };
                
            google.visualization.drawChart({
                "containerId": "curve_chart",
                "dataTable": [['Mois', 'Température'], ...data ],
                "refreshInterval": 5,
                "chartType": "AreaChart",
                "options": options
            });
        }
    
        google.charts.setOnLoadCallback(() => drawVisualization(all_data));
    
        function actualizarGrafico(data) {
            // Filtrar los datos para obtener solo los datos que no existen en all_data
            const newDataFiltered = data.filter((item) => {
                const index = all_data.findIndex((item2) => item2[0] === item[0]);
                return index === -1;
            });
            
            console.log(newDataFiltered);
            if (newDataFiltered.length === 0) return;
    
            drawVisualization(newDataFiltered);
        }
    
        // Iniciar la actualización automática del gráfico cada segundo
        setInterval(() => actualizarGrafico(all_data), 1000);
    </script>

    
    
</body>
</html>